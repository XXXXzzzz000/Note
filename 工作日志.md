# 宣泽 工作日志 Week#6

目前主要工作任务:

# Day 1

- 修改蓝牙-stm32交互模块
  - [x] esp32串口通信
  - [x] TinyFrame(通信数据包框架)
  - [ ] 定义通信内容(暂时使用简单数据)
  - [x] 蓝牙写入回调中通过串口发送信息
- 编写蓝牙app
  - [ ] android 开发环境搭建
  - [ ] 
## TODO:

- 修改PID算法添加无time模式
- bug:电流检测出现新bug,在数据转换的过程中卡死
- 电机驱动+电流检测+图像显示数据
- 添加PID控制
- check代码命名规则/继续查看 misrac

- 完成霍尔传感器(速度检测部分的设计及文档编写)(重新修改start stop等函数)
- 添加pid算法
    - 扭矩环(电流环)
    - 速度环(电压环)
- 速度反馈,占空比输出,调节pid参数
- 电机pid
- 过流保护
- 

```

systime_t t;
t=chVTGetSystemTimeX();//获取当前系统时间
chVTTimeElapsedSinceX(t);//计算两次时间间隔


//时间获取需要通过RTC2S（freq，n）等宏,frep可以使用 STM32_SYSCLK

# tim等平台相关lld
C:\ChibiStudio\chibios176\os\hal\ports\STM32
# shell头文件  
C:\ChibiStudio\chibios176\os\various\shell

# 修改:
motor
1.防止短路(状态转换)
2.pwm 调度
## pwm
1.正转
2.反转
3.惰行
4.刹车
需要记录电机状态
## ADC(电流检测)
单次数据采集结束,将数据
1.暂存
2.处理
3.保存
或
1.处理转换好的一半
2.保存
## ext(速度检测)
霍尔传感器高ext回调
(两次回调求一次速度)
```

